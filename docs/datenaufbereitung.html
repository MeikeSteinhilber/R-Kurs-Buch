<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Datenaufbereitung | R Kurs Buch</title>
  <meta name="description" content="<p>Dies sind R Kurs Unterlagen für Lehre in verschiedenen studentischen
Veranstaltungen.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Datenaufbereitung | R Kurs Buch" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://amd-lab.github.io/R-Kurs-Buch/" />
  
  <meta property="og:description" content="<p>Dies sind R Kurs Unterlagen für Lehre in verschiedenen studentischen
Veranstaltungen.</p>" />
  <meta name="github-repo" content="AMD-Lab/R-Kurs-Buch" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Datenaufbereitung | R Kurs Buch" />
  
  <meta name="twitter:description" content="<p>Dies sind R Kurs Unterlagen für Lehre in verschiedenen studentischen
Veranstaltungen.</p>" />
  



<meta name="date" content="2021-10-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="einführung.html"/>

<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Über dieses Buch</a></li>
<li class="chapter" data-level="2" data-path="einführung.html"><a href="einführung.html"><i class="fa fa-check"></i><b>2</b> Einführung</a></li>
<li class="chapter" data-level="3" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html"><i class="fa fa-check"></i><b>3</b> Datenaufbereitung</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#einführung-in-dplyr-und-tidyverse"><i class="fa fa-check"></i><b>3.1</b> Einführung in Dplyr und tidyverse</a></li>
<li class="chapter" data-level="3.2" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#dplyr-die-wichtigsten-befehle"><i class="fa fa-check"></i><b>3.2</b> Dplyr: Die wichtigsten Befehle</a></li>
<li class="chapter" data-level="3.3" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#übung-1"><i class="fa fa-check"></i><b>3.3</b> Übung 1</a></li>
<li class="chapter" data-level="3.4" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#dplyr-der-piping-operator"><i class="fa fa-check"></i><b>3.4</b> Dplyr: Der Piping Operator</a></li>
<li class="chapter" data-level="3.5" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#beispiel"><i class="fa fa-check"></i><b>3.5</b> Beispiel</a></li>
<li class="chapter" data-level="3.6" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#übung-2"><i class="fa fa-check"></i><b>3.6</b> Übung 2</a></li>
<li class="chapter" data-level="3.7" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#dplyr-neue-variablen-mit-mutate-berechnen"><i class="fa fa-check"></i><b>3.7</b> Dplyr : Neue Variablen mit <code>mutate()</code> berechnen</a></li>
<li class="chapter" data-level="3.8" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#beispiel-1"><i class="fa fa-check"></i><b>3.8</b> Beispiel</a></li>
<li class="chapter" data-level="3.9" data-path="datenaufbereitung.html"><a href="datenaufbereitung.html#aufgabe-bis-zum-nächsten-mal"><i class="fa fa-check"></i><b>3.9</b> Aufgabe bis zum nächsten Mal</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Kurs Buch</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datenaufbereitung" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Datenaufbereitung</h1>
<div id="einführung-in-dplyr-und-tidyverse" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Einführung in Dplyr und tidyverse</h2>
<p>Dplyr ist Teil des tidyverse Packages und ermöglicht es, Daten sehr einfach zu manipulieren und in eine Form zu bringen, um diese dann zu analysieren. Um das zu tun greifen wir auf den Star Wars Datensatz zurück, den das dplyr Package mitliefert:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="datenaufbereitung.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lest die Daten bitte ein, der Datensatz heisst &quot;starwars.RDS&quot; und befindet sich in eurem Projektordner, diesmal benutzen wir den readRDS() Befehl.</span></span>
<span id="cb1-2"><a href="datenaufbereitung.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="datenaufbereitung.html#cb1-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;starwars.RDS&quot;</span>)</span></code></pre></div>
<p>Der Datensatz enthält Informationen über unsere Star Wars Helden, ähnlich dem Datensatz, den wir uns in der letzten Sitzung ausgedacht haben:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="datenaufbereitung.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars,<span class="dv">5</span>) <span class="co"># Wir lassen uns erstmal die ersten 5 Zeilen des Datensatzes ausgeben</span></span></code></pre></div>
<pre><code>## # A tibble: 5 x 11
##   name           height  mass hair_color skin_color  eye_color   Age sex    gender    homeworld species
##   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;chr&gt;     &lt;chr&gt;  
## 1 Luke Skywalker    172    77 blond      fair        blue       19   male   masculine Tatooine  Human  
## 2 C-3PO             167    75 &lt;NA&gt;       gold        yellow    112   none   masculine Tatooine  Droid  
## 3 R2-D2              96    32 &lt;NA&gt;       white, blue red        33   none   masculine Naboo     Droid  
## 4 Darth Vader       202   136 none       white       yellow     41.9 male   masculine Tatooine  Human  
## 5 Leia Organa       150    49 brown      light       brown      19   female feminine  Alderaan  Human</code></pre>
<p>Bevor wir einsteigen, schaut euch an, wie die einzelnen Variablen im Datensatz verteilt sind. Benutzt dazu den den <code>summary()</code> Befehl, was fällt euch auf ?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="datenaufbereitung.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(starwars)</span></code></pre></div>
<pre><code>##      name               height           mass           hair_color   skin_color   eye_color 
##  Length:87          Min.   : 66.0   Min.   :  15.00   none   :37   fair   :17   brown  :21  
##  Class :character   1st Qu.:167.0   1st Qu.:  55.60   brown  :18   light  :11   blue   :19  
##  Mode  :character   Median :180.0   Median :  79.00   black  :13   dark   : 6   yellow :11  
##                     Mean   :174.4   Mean   :  97.31   white  : 4   green  : 6   black  :10  
##                     3rd Qu.:191.0   3rd Qu.:  84.50   blond  : 3   grey   : 6   orange : 8  
##                     Max.   :264.0   Max.   :1358.00   (Other): 7   pale   : 5   red    : 5  
##                     NA&#39;s   :6       NA&#39;s   :28        NA&#39;s   : 5   (Other):36   (Other):13  
##       Age                     sex           gender    homeworld           species         
##  Min.   :  8.00   female        :16   feminine :17   Length:87          Length:87         
##  1st Qu.: 35.00   hermaphroditic: 1   masculine:66   Class :character   Class :character  
##  Median : 52.00   male          :60   NA&#39;s     : 4   Mode  :character   Mode  :character  
##  Mean   : 87.57   none          : 6                                                       
##  3rd Qu.: 72.00   NA&#39;s          : 4                                                       
##  Max.   :896.00                                                                           
##  NA&#39;s   :44</code></pre>
</div>
<div id="dplyr-die-wichtigsten-befehle" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Dplyr: Die wichtigsten Befehle</h2>
<ul>
<li><p>Filtern von Beobachtungen nach Wert (<a href="https://rdrr.io/r/stats/filter.html"><code>filter()</code></a>).</p></li>
<li><p>Reihen neu Sortieren (<code>arrange()</code>).</p></li>
<li><p>Auswahl von Variablen nach Name (<code>select()</code>).</p></li>
<li><p>Erstellen von neuen Variablen aus bereits existierenden (<code>mutate()</code>).</p></li>
<li><p>Viele Werte zu einem einzelnen Wert zusammenfassen (<code>summarise()</code>).</p></li>
</ul>
<p>Der vielleicht wichtigste Befehl ist der <code>group_by()</code> Befehl, mit dem Ihr die oben genannten Befehle auf einzelne Gruppen innerhalb eines Datensatzes anwenden könnt.</p>
<p>Diese 6 sogennaten “Verben” bilden die Grundlage für tidyverse.Damit ist es möglichmehrere einfache Schritte miteinander zu verketten, um ein komplexes Ergebnis zu erzielen. Alles Befehle funktionieren auf die gleiche Art und Weise:</p>
<ol style="list-style-type: decimal">
<li><p>Das erste Argument ist ein Dataframe.</p></li>
<li><p>Die nachfolgenden Argumente beschreiben, was mit dem Dataframe geschehen soll, wobei die Variablennamen (ohne Anführungszeichen) verwendet werden.</p></li>
<li><p>Das Ergebnis ist ein neuer Dataframe</p></li>
</ol>
<p>Hier ein Beispiel, zum <code>filter()</code> Befehl, dazu müsst ihr auch wissen, wie Ihr die gewünschten Beobachtungen mit Hilfe der Vergleichsoperatoren auswählen können. R bietet euch hier die Standardoperatoren:</p>
<ol style="list-style-type: decimal">
<li><p><code>&gt;</code> (größer)</p></li>
<li><p><code>&gt;=</code> (größer gleich)</p></li>
<li><p><code>&lt;</code> (kleiner)</p></li>
<li><p><code>&lt;=</code> (kleiner gleich)</p></li>
<li><p><code>!=</code> (nicht gleich)</p></li>
<li><p><code>==</code>(gleich)</p></li>
</ol>
<p>Anmerkung: Es gibt auch noch logische Operatoren, also “und,” “oder” etc. Diese Besprechen wir nicht im Detail, da das sonst zu viel würde. Die Logik der Anwendungen ist aber genau gleich wie bei den Vergleichsoperatoren, hier nur der Vollstädigkeit halber eine übersicht über diese Operatoren:<br />
</p>
<div class="figure">
<img src="https://d33wubrfki0l68.cloudfront.net/01f4b6d39d2be8269740a3ad7946faa79f7243cf/8369a/diagrams/transform-logical.png" title="Logische Operatoren und Ihre Aussage" width="800" alt="" />
<p class="caption">Logische Operatoren in R</p>
</div>
<p>Beispiel</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="datenaufbereitung.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wenn wir zum Beispiel wissen wollen, wer die größten und schwersten Charaktere aus Starwars sind, dann könnten wir dies so machen:</span></span>
<span id="cb6-2"><a href="datenaufbereitung.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="datenaufbereitung.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(starwars, height <span class="sc">&gt;</span> <span class="dv">190</span>, mass <span class="sc">&gt;</span> <span class="dv">90</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   name            height  mass hair_color skin_color   eye_color       Age sex   gender    homeworld species
##   &lt;chr&gt;            &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;        &lt;fct&gt;         &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;     &lt;chr&gt;  
## 1 Darth Vader        202   136 none       white        yellow         41.9 male  masculine Tatooine  Human  
## 2 Chewbacca          228   112 brown      unknown      blue          200   male  masculine Kashyyyk  Wookiee
## 3 IG-88              200   140 none       metal        red            15   none  masculine &lt;NA&gt;      Droid  
## 4 Dexter Jettster    198   102 none       brown        yellow         NA   male  masculine Ojom      Besali~
## 5 Grievous           216   159 none       brown, white green, yellow  NA   male  masculine Kalee     Kaleesh
## 6 Tarfful            234   136 brown      brown        blue           NA   male  masculine Kashyyyk  Wookiee</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="datenaufbereitung.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wir filtern hier alle heraus, die größer sind als 190 und mehr als 90 Kilo wiegen</span></span></code></pre></div>
<p>Wenn man mit Strings arbeitet sucht man häufig nach bestimmen <code>pattern</code> in den Strings, wie hier bei den Namen. Wollen wir nun alle Skywalkers filtern, müssen wir die <code>grepl()</code> Funktion aus R nutzen. Diese prüft, ob eine Zeichenfolge vorhanden ist oder nicht und gibt dann entsprechend TRUE oder FALSE aus, also perfekt für <code>filter()</code> . Bei Strings die nur aus einem Wort bestehen, funktioniert aber auch <code>filter(starwars, species=="human").</code></p>
<p>Beispiel:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="datenaufbereitung.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(starwars, species <span class="sc">==</span> <span class="st">&quot;Human&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 35 x 11
##    name              height  mass hair_color    skin_color eye_color   Age sex    gender   homeworld species
##    &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;         &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;    &lt;chr&gt;     &lt;chr&gt;  
##  1 Luke Skywalker       172    77 blond         fair       blue       19   male   masculi~ Tatooine  Human  
##  2 Darth Vader          202   136 none          white      yellow     41.9 male   masculi~ Tatooine  Human  
##  3 Leia Organa          150    49 brown         light      brown      19   female feminine Alderaan  Human  
##  4 Owen Lars            178   120 brown, grey   light      blue       52   male   masculi~ Tatooine  Human  
##  5 Beru Whitesun la~    165    75 brown         light      blue       47   female feminine Tatooine  Human  
##  6 Biggs Darklighter    183    84 black         light      brown      24   male   masculi~ Tatooine  Human  
##  7 Obi-Wan Kenobi       182    77 auburn, white fair       blue-gray  57   male   masculi~ Stewjon   Human  
##  8 Anakin Skywalker     188    84 blond         fair       blue       41.9 male   masculi~ Tatooine  Human  
##  9 Wilhuff Tarkin       180    NA auburn, grey  fair       blue       64   male   masculi~ Eriadu    Human  
## 10 Han Solo             180    80 brown         fair       brown      29   male   masculi~ Corellia  Human  
## # ... with 25 more rows</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="datenaufbereitung.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle Helden, mit dem Nachnamen Skywalker</span></span>
<span id="cb11-2"><a href="datenaufbereitung.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="datenaufbereitung.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(starwars, <span class="fu">grepl</span>(<span class="st">&quot;Skywalker&quot;</span>, name))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 11
##   name             height  mass hair_color skin_color eye_color   Age sex    gender    homeworld species
##   &lt;chr&gt;             &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;chr&gt;     &lt;chr&gt;  
## 1 Luke Skywalker      172    77 blond      fair       blue       19   male   masculine Tatooine  Human  
## 2 Anakin Skywalker    188    84 blond      fair       blue       41.9 male   masculine Tatooine  Human  
## 3 Shmi Skywalker      163    NA black      fair       brown      72   female feminine  Tatooine  Human</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="datenaufbereitung.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Es wird im Datensatz starwars nach dem String &quot;Skywalker&quot; in der Spalte name gesucht. </span></span>
<span id="cb13-2"><a href="datenaufbereitung.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Das Ergebnis sieht dann so aus: </span></span></code></pre></div>
<p>Wichtig ist natürlich für uns auch der Umgang mit Faktoren. Glücklicherweise ist das viel einfacher als mit Strings:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="datenaufbereitung.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wenn wir nun nach einem bestimmten Faktor-Level Filtern wollen geht das genauso wie mit numerischen Werten:</span></span>
<span id="cb14-2"><a href="datenaufbereitung.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="datenaufbereitung.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(starwars, sex <span class="sc">==</span> <span class="st">&quot;male&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 60 x 11
##    name              height  mass hair_color    skin_color eye_color   Age sex   gender    homeworld species
##    &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;         &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;     &lt;chr&gt;  
##  1 Luke Skywalker       172    77 blond         fair       blue       19   male  masculine Tatooine  Human  
##  2 Darth Vader          202   136 none          white      yellow     41.9 male  masculine Tatooine  Human  
##  3 Owen Lars            178   120 brown, grey   light      blue       52   male  masculine Tatooine  Human  
##  4 Biggs Darklighter    183    84 black         light      brown      24   male  masculine Tatooine  Human  
##  5 Obi-Wan Kenobi       182    77 auburn, white fair       blue-gray  57   male  masculine Stewjon   Human  
##  6 Anakin Skywalker     188    84 blond         fair       blue       41.9 male  masculine Tatooine  Human  
##  7 Wilhuff Tarkin       180    NA auburn, grey  fair       blue       64   male  masculine Eriadu    Human  
##  8 Chewbacca            228   112 brown         unknown    blue      200   male  masculine Kashyyyk  Wookiee
##  9 Han Solo             180    80 brown         fair       brown      29   male  masculine Corellia  Human  
## 10 Greedo               173    74 &lt;NA&gt;          green      black      44   male  masculine Rodia     Rodian 
## # ... with 50 more rows</code></pre>
</div>
<div id="übung-1" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Übung 1</h2>
<p>Filtert nun selbst den Datensatz nach bestimmten Kriterien</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="datenaufbereitung.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.) Filtert alle Helden, die Älter sind als 20 und größer als 160 sind</span></span>
<span id="cb16-2"><a href="datenaufbereitung.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="datenaufbereitung.html#cb16-3" aria-hidden="true" tabindex="-1"></a>fat_starwars <span class="ot">&lt;-</span> <span class="fu">filter</span>(starwars, Age <span class="sc">&gt;</span> <span class="dv">20</span>, height <span class="sc">&gt;</span> <span class="dv">160</span>)</span>
<span id="cb16-4"><a href="datenaufbereitung.html#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="datenaufbereitung.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.) Filtert alle Helden, die Blaue Augen haben und männlich sind</span></span>
<span id="cb16-6"><a href="datenaufbereitung.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="datenaufbereitung.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(starwars, eye_color <span class="sc">==</span> <span class="st">&quot;blue&quot;</span>, sex <span class="sc">==</span> <span class="st">&quot;male&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 11
##    name             height  mass hair_color   skin_color eye_color   Age sex   gender    homeworld  species 
##    &lt;chr&gt;             &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;        &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;      &lt;chr&gt;   
##  1 Luke Skywalker      172    77 blond        fair       blue       19   male  masculine Tatooine   Human   
##  2 Owen Lars           178   120 brown, grey  light      blue       52   male  masculine Tatooine   Human   
##  3 Anakin Skywalker    188    84 blond        fair       blue       41.9 male  masculine Tatooine   Human   
##  4 Wilhuff Tarkin      180    NA auburn, grey fair       blue       64   male  masculine Eriadu     Human   
##  5 Chewbacca           228   112 brown        unknown    blue      200   male  masculine Kashyyyk   Wookiee 
##  6 Jek Tono Porkins    180   110 brown        fair       blue       NA   male  masculine Bestine IV Human   
##  7 Lobot               175    79 none         light      blue       37   male  masculine Bespin     Human   
##  8 Qui-Gon Jinn        193    89 brown        fair       blue       92   male  masculine &lt;NA&gt;       Human   
##  9 Finis Valorum       170    NA blond        fair       blue       91   male  masculine Coruscant  Human   
## 10 Mas Amedda          196    NA none         blue       blue       NA   male  masculine Champala   Chagrian
## 11 Cliegg Lars         183    NA brown        fair       blue       82   male  masculine Tatooine   Human   
## 12 Tarfful             234   136 brown        brown      blue       NA   male  masculine Kashyyyk   Wookiee</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="datenaufbereitung.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.) Filtert alle, die zur Spezies Droid gehören</span></span>
<span id="cb18-2"><a href="datenaufbereitung.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="datenaufbereitung.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(starwars, species<span class="sc">==</span><span class="st">&quot;Droid&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   name   height  mass hair_color skin_color  eye_color   Age sex   gender    homeworld species
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;chr&gt;     &lt;chr&gt;  
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow      112 none  masculine Tatooine  Droid  
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red          33 none  masculine Naboo     Droid  
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red          NA none  masculine Tatooine  Droid  
## 4 IG-88     200   140 none       metal       red          15 none  masculine &lt;NA&gt;      Droid  
## 5 R4-P17     96    NA none       silver, red red, blue    NA none  feminine  &lt;NA&gt;      Droid  
## 6 BB8        NA    NA none       none        black        NA none  masculine &lt;NA&gt;      Droid</code></pre>
</div>
<div id="dplyr-der-piping-operator" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Dplyr: Der Piping Operator</h2>
<p>Jetzt wisst ihr, wie man Daten filtert. Das ist aber nur eine der Basisfunktionen von dplyr. Die vielleicht wichtigste Funktion der sogenannte “piping operator” <code>%&gt;%</code> Mit diesem könnt ihr die Befehle kombinieren, oder auch “verketten” um die Datensätze nach euren Wünschen umzugestalten. Das funktioniert auch immer nach den oben genannten Prinzipien:</p>
<ol style="list-style-type: decimal">
<li><p>Das erste Argument ist ein Dataframe.</p></li>
<li><p>Die nachfolgenden Argumente beschreiben, was mit dem Dataframe geschehen soll, wobei die Variablennamen (ohne Anführungszeichen) verwendet werden.</p></li>
<li><p>Das Ergebnis ist ein neuer Dataframe</p></li>
</ol>
<p>Wir werden hier erstmal nur die basis dplyr-Funktionen besprechen. Aber auch alle anderen Befehle lassen sich in eine “Pipeline” integrieren. Hier mal ein sehr fortgeschrittenes Beispiel, wie das aussehen kann:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="datenaufbereitung.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_clean %&gt;% group_by(N,K,Retrievals) %&gt;%  </span></span>
<span id="cb20-2"><a href="datenaufbereitung.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(corA = cor(mu_est_a, mu_real_a),</span></span>
<span id="cb20-3"><a href="datenaufbereitung.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#             corC = cor(mu_est_c, mu_real_c)) %&gt;%</span></span>
<span id="cb20-4"><a href="datenaufbereitung.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(z_a = fisherz(corA), z_c = fisherz(corC)) %&gt;% </span></span>
<span id="cb20-5"><a href="datenaufbereitung.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Retrievals== 100) %&gt;%</span></span>
<span id="cb20-6"><a href="datenaufbereitung.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(N,K) %&gt;%  </span></span>
<span id="cb20-7"><a href="datenaufbereitung.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(mean_a_100 = mean(z_a),</span></span>
<span id="cb20-8"><a href="datenaufbereitung.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#             mean_c_100 = mean(z_c),</span></span>
<span id="cb20-9"><a href="datenaufbereitung.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#             range_cor = range(mean_a_100),</span></span>
<span id="cb20-10"><a href="datenaufbereitung.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#             range_cor = range(mean_a_100)) %&gt;%</span></span>
<span id="cb20-11"><a href="datenaufbereitung.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(meanCorA_100 = fisherz2r(mean_a_100),</span></span>
<span id="cb20-12"><a href="datenaufbereitung.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#          meanCorC_100 = fisherz2r(mean_c_100)) %&gt;%</span></span>
<span id="cb20-13"><a href="datenaufbereitung.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-c(mean_a_100, mean_c_100))</span></span></code></pre></div>
</div>
<div id="beispiel" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Beispiel</h2>
<p>Stellt euch vor, ihr wollte gerne den Mittelwert des Alters der Helden aus dem Starwars Datensatz berechnen, und das für unterschiedliche Heimatwelten und Spezies:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="datenaufbereitung.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dazu benutzen wir den Piping Operator %&gt;%, um die Befehle zu verketten:</span></span>
<span id="cb21-2"><a href="datenaufbereitung.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="datenaufbereitung.html#cb21-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="datenaufbereitung.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, homeworld) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="datenaufbereitung.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_Age=</span><span class="fu">mean</span>(Age))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;species&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 58 x 3
## # Groups:   species [38]
##    species  homeworld   mean_Age
##    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
##  1 Aleena   Aleen Minor       NA
##  2 Besalisk Ojom              NA
##  3 Cerean   Cerea             92
##  4 Chagrian Champala          NA
##  5 Clawdite Zolan             NA
##  6 Droid    Naboo             33
##  7 Droid    Tatooine          NA
##  8 Droid    &lt;NA&gt;              NA
##  9 Dug      Malastare         NA
## 10 Ewok     Endor              8
## # ... with 48 more rows</code></pre>
<p>Wir schreiben hier im Prinzip:</p>
<ol style="list-style-type: decimal">
<li>Nehme den Datensatz starwars (1. Zuerst der Dataframe):</li>
</ol>
<!-- -->
<pre><code>`starwars %&gt;%`</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Gruppiere diesen nach Spezies und Heimatwelt (1. Verarbeitungsschritt):</p>
<p><code>`group_by(species, homeworld) %&gt;%`</code></p></li>
<li><p>Berechne dann für jede dieser Gruppen den Mittelwert für die Variable “Age” (2. Schritt):</p></li>
</ol>
<!-- -->
<pre><code>`summarise(meanAge=mean(Age)`</code></pre>
<p>Da wir nun den Piping Operator benutzen der vom Dataframe starwars ausgeht, müssen wir auch nicht mehr bei jedem Befehl den Datensatz angeben, es reicht dies am Anfang der “Pipeline” zu tun.</p>
<p>Problem: Wir haben noch viele fehlende Beobachtungen. Diese müssen wir zunächst entfehrnen. Auch das können wir nun innerhalb der “Pipeline” tun. Dazu bietet R den Befehl <code>drop_na()</code> an. Dieser entfehrnt alle fehlenden Werte eines Datensatzes.</p>
<p>Wir müssen diesen Befehl nun einfach an eine Stelle in der Pipe einfügen, an der es Sinn macht, die Fehlenden Werte zu entfehrnen:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="datenaufbereitung.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wo könnte das hier sein ? </span></span>
<span id="cb26-2"><a href="datenaufbereitung.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="datenaufbereitung.html#cb26-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="datenaufbereitung.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, homeworld) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="datenaufbereitung.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_Age=</span><span class="fu">mean</span>(Age))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;species&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 21 x 3
## # Groups:   species [11]
##    species homeworld    mean_Age
##    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
##  1 Cerean  Cerea            92  
##  2 Ewok    Endor             8  
##  3 Gungan  Naboo            52  
##  4 Human   Alderaan         19  
##  5 Human   Bespin           37  
##  6 Human   Concord Dawn     66  
##  7 Human   Corellia         25  
##  8 Human   Haruun Kal       72  
##  9 Human   Kamino           31.5
## 10 Human   Naboo            64  
## # ... with 11 more rows</code></pre>
<p>Nun haben wir nach verschiedenen Gruppen die Altersmittelwerte, bereinigt von den fehlenden Werten. Und das mit nur 2 Zeilen Code :)</p>
</div>
<div id="übung-2" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Übung 2</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="datenaufbereitung.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.) Gruppiert die Daten nach der Haarfarbe und berechnet für alle vollständigen Werte den Mittelwert und die Standardabweichung für die Größe und das Gewicht. Benutzt dafür wie im vorigen Beispiel die summarise() Funktion. Mit dieser könnt ihr auch mehrere Variablen berechnen. Bindet auch den drop_na() ein. Am Ende sollte es keine NA-Werte mehr in der Ausgabe geben. </span></span>
<span id="cb29-2"><a href="datenaufbereitung.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="datenaufbereitung.html#cb29-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(hair_color) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="datenaufbereitung.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_Height =</span> <span class="fu">mean</span>(height),</span>
<span id="cb29-5"><a href="datenaufbereitung.html#cb29-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_Height=</span> <span class="fu">sd</span>(height),</span>
<span id="cb29-6"><a href="datenaufbereitung.html#cb29-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_Mass =</span> <span class="fu">mean</span>(mass),</span>
<span id="cb29-7"><a href="datenaufbereitung.html#cb29-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_Mass =</span> <span class="fu">sd</span>(mass)) </span></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   hair_color    mean_Height sd_Height mean_Mass sd_Mass
##   &lt;fct&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 auburn, white        182      NA         77     NA   
## 2 black                177       7.46      71.1   14.2 
## 3 blond                180      11.3       80.5    4.95
## 4 brown                164.     41.6       65.4   29.9 
## 5 brown, grey          178      NA        120     NA   
## 6 grey                 170      NA         75     NA   
## 7 none                 186.      9.50      86.2   24.3 
## 8 white                196.      3.54      81      1.41</code></pre>
</div>
<div id="dplyr-neue-variablen-mit-mutate-berechnen" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Dplyr : Neue Variablen mit <code>mutate()</code> berechnen</h2>
<p>Der letzte wichtige Befehl in dplyr ist <code>mutate()</code> bzw. <code>across()</code>. Letztes mal haben wir in dem Beispiel der Matrix zwei Variablen miteinander kombiniert und daraus einen neue berechnet (Größe*5). Mit <code>mutate()</code> können wir eine Variable und mit <code>across()</code> gleich mehrere Variablen umformen, oder neu berechnen. Hier möchte ich es am Beispiel einer z-Tranformation erläutern. Diese werden wir mit dem Befehl <code>scale()</code> tun, der standardmäßig in R vorhanden ist.</p>
</div>
<div id="beispiel-1" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Beispiel</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="datenaufbereitung.html#cb31-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="datenaufbereitung.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(height,mass) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="datenaufbereitung.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_height =</span> <span class="fu">scale</span>(height),</span>
<span id="cb31-4"><a href="datenaufbereitung.html#cb31-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_mass =</span> <span class="fu">scale</span>(mass)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="datenaufbereitung.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code></pre></div>
<pre><code>## # A tibble: 59 x 4
##    height  mass z_height[,1] z_mass[,1]
##     &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77      -0.0678    -0.120 
##  2    167    75      -0.212     -0.132 
##  3     96    32      -2.25      -0.385 
##  4    202   136       0.795      0.228 
##  5    150    49      -0.701     -0.285 
##  6    178   120       0.105      0.134 
##  7    165    75      -0.269     -0.132 
##  8     97    32      -2.22      -0.385 
##  9    183    84       0.249     -0.0786
## 10    182    77       0.220     -0.120 
## # ... with 49 more rows</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="datenaufbereitung.html#cb33-1" aria-hidden="true" tabindex="-1"></a> starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(height,mass) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="datenaufbereitung.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(height,mass), <span class="fu">list</span>(<span class="at">z=</span>scale))) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="datenaufbereitung.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code></pre></div>
<pre><code>## # A tibble: 59 x 4
##    height  mass height_z[,1] mass_z[,1]
##     &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77      -0.0678    -0.120 
##  2    167    75      -0.212     -0.132 
##  3     96    32      -2.25      -0.385 
##  4    202   136       0.795      0.228 
##  5    150    49      -0.701     -0.285 
##  6    178   120       0.105      0.134 
##  7    165    75      -0.269     -0.132 
##  8     97    32      -2.22      -0.385 
##  9    183    84       0.249     -0.0786
## 10    182    77       0.220     -0.120 
## # ... with 49 more rows</code></pre>
<p>In diesem Beispiel haben wir zunächste nur <code>height</code> und <code>mass</code> mit dem <code>select()</code> Befehl ausgewählt, daher werden auch nur diese beiden Spalten am Ende der Pipline im Datensatz angezeigt. Dies kann hilfreich sein, wenn man einen Datensatz mit sehr vielen Variablen analysieren muss, von denen nur einige wenige interessant sind. Dies ist meiner Erfahrung nach zum Beispiel bei Fragebögen der Fall, die unterschiedliche Facetten erfassen.</p>
<p>Der nächste Befehl <code>mutate()</code> besteht immer aus einer Operation, die mit einer Spalte im Datensatz durchgeführt wird. Im Beispiel oben fügen wir also die Spalten <code>z_height</code> und <code>z_mass</code> hinzu, die sich jeweils aus <code>scale(SPALTENNAME)</code> berechnen und die z-Werte der jeweiligen Variablen berechnen.</p>
<p>Wir können auch anstatt die Variablen einzeln umzurechnen, den Befehl <code>scale()</code> direkt auf mehrere Spalten anwenden. Dazu können wir den <code>across()</code> Befehl verwenden. Hier müssen wir innerhalb von <code>mutate()</code> einfach mit <code>across(c(SPALTE1, SPALTE2))</code> einen Vektor der gewünschten Spalten übergeben und dann die Funktion(en), welche auf die Spalten angewand werden soll. Dies muss dann so definiert werden:</p>
<p><code>mutate(across(c(height,mass), list(z=scale)))</code></p>
<p>Diese Schreibweise hat den Vorteil das ihr</p>
<ol style="list-style-type: decimal">
<li><p>In der <code>list()</code> mehrere Befehle übergeben könnt</p></li>
<li><p>Die Originalspalten beibehalten werden</p></li>
<li><p>Ihr den neuen Spalten direkt einen Suffix geben könnt.<br />
Dieser wird automatisch als “_suffix” an die neue Variable angehängt.</p>
<p><code>mutate(across(c(height,mass), list(z=scale)))</code> würde also zusätzliche zu Spalte1 und Spalte2 noch Spalte1_z und Spalte2_z, die den z-Wert der jeweiligen Variablen</p></li>
</ol>
</div>
<div id="aufgabe-bis-zum-nächsten-mal" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Aufgabe bis zum nächsten Mal</h2>
<p>Übersetzt diese Anweisungen in dplyr-Sprache:</p>
<ol style="list-style-type: decimal">
<li>Dataframe starwars</li>
<li>Gruppiert diesen nach Spezies</li>
<li>Entfehrnt alle fehlenden Werte</li>
<li>Fasst die Variablen Age und Height zu nur einem Mittelwert zusammen</li>
<li>z-Transformiert die Mittelwerte beider Spalten.</li>
</ol>
<p>Befehle die Ihr dazu braucht:</p>
<p><code>drop_na(), across()</code> ,<code>scale(), mutate(), group_by(), summarise(), mean()</code></p>
<p>Wenn ihr es Richtig gemacht habt, sollte der Datensatz am Ende so aussehen:</p>
<p><img src="Merged_Data.png" /></p>
<p><em>Zusatzaufgabe:</em></p>
<p><em>Ihr könnt den <code>summarise()</code> Befehl auch mit <code>across()</code> umsetzen und automatisch einen Suffix für die zusammengefassten Variablen erstellen, hierdurch spart man sich einige Tipparbeit. Das Ergebnis ist das gleiche, nur mit unterschiedlichen Spaltenamen für die “mean” Variablen.</em></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="datenaufbereitung.html#cb35-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="datenaufbereitung.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="datenaufbereitung.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_Age =</span> <span class="fu">mean</span>(Age),</span>
<span id="cb35-4"><a href="datenaufbereitung.html#cb35-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_Height =</span> <span class="fu">mean</span>(height)) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="datenaufbereitung.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_Age_z =</span> <span class="fu">scale</span>(mean_Age),</span>
<span id="cb35-6"><a href="datenaufbereitung.html#cb35-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_Height_z =</span> <span class="fu">scale</span>(mean_Height))</span></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    species      mean_Age mean_Height mean_Age_z[,1] mean_Height_z[,1]
##    &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;
##  1 Cerean           92           198          0.622            0.561 
##  2 Ewok              8            88         -1.03            -2.66  
##  3 Gungan           52           196         -0.166            0.503 
##  4 Human            45.5         178         -0.293           -0.0239
##  5 Kel Dor          22           188         -0.757            0.269 
##  6 Mirialan         49           168         -0.225           -0.317 
##  7 Mon Calamari     41           180         -0.382            0.0346
##  8 Trandoshan       53           190         -0.146            0.327 
##  9 Twi&#39;lek          48           178         -0.245           -0.0239
## 10 Wookiee         200           228          2.75             1.44  
## 11 Zabrak           54           175         -0.126           -0.112</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="datenaufbereitung.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mit across()</span></span>
<span id="cb37-2"><a href="datenaufbereitung.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="datenaufbereitung.html#cb37-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="datenaufbereitung.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="datenaufbereitung.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(Age, height), <span class="fu">list</span>(<span class="at">mean=</span> mean))) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="datenaufbereitung.html#cb37-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(Age_mean, height_mean), <span class="fu">list</span>(<span class="at">z=</span>scale)))</span></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    species      Age_mean height_mean Age_mean_z[,1] height_mean_z[,1]
##    &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;
##  1 Cerean           92           198          0.622            0.561 
##  2 Ewok              8            88         -1.03            -2.66  
##  3 Gungan           52           196         -0.166            0.503 
##  4 Human            45.5         178         -0.293           -0.0239
##  5 Kel Dor          22           188         -0.757            0.269 
##  6 Mirialan         49           168         -0.225           -0.317 
##  7 Mon Calamari     41           180         -0.382            0.0346
##  8 Trandoshan       53           190         -0.146            0.327 
##  9 Twi&#39;lek          48           178         -0.245           -0.0239
## 10 Wookiee         200           228          2.75             1.44  
## 11 Zabrak           54           175         -0.126           -0.112</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="einführung.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
